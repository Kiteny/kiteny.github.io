(this["webpackJsonpmy-chat"]=this["webpackJsonpmy-chat"]||[]).push([[0],{61:function(e,t,r){},62:function(e,t,r){},63:function(e,t,r){},64:function(e,t,r){},83:function(e,t,r){},84:function(e,t,r){},85:function(e,t,r){},86:function(e,t,r){},87:function(e,t,r){},88:function(e,t,r){},89:function(e,t,r){"use strict";r.r(t);var a=r(2),n=r(0),s=r.n(n),c=r(27),o=r.n(c),i=r(8),u=r(21),b=r(10),l=r(30),d=r(9),p=(r(61),function(e){var t=e.name,r=e.type,n=e.forwardedRef,s=e.title,c=e.errorMessage;return Object(a.jsxs)("label",{htmlFor:t,className:"ui-field",children:[Object(a.jsxs)("h4",{className:"ui-field__title",children:[s,":"]}),Object(a.jsx)("div",{className:"ui-field__error-message",children:c}),Object(a.jsx)("input",{name:t,id:t,type:r,ref:n})]})});p.defaultProps={errorMessage:""};var j=s.a.forwardRef((function(e,t){return Object(a.jsx)(p,Object(d.a)(Object(d.a)({},e),{},{forwardedRef:t}))})),f=(r(62),function(e){var t=e.title,r=e.type;return Object(a.jsx)("button",{className:"ui-button",type:r,children:t})});f.defaultProps={type:"button"};var m=f,h=(r(63),function(){return Object(a.jsxs)("div",{className:"lds-ripple",children:[Object(a.jsx)("div",{}),Object(a.jsx)("div",{})]})}),x=(r(64),function(e){var t=e.onSubmit,r=e.title,n=e.buttonTitle,s=e.children,c=e.link,o=e.errorMessage,i=e.showLoader;return Object(a.jsxs)("form",{onSubmit:t,className:"user-form app-border",children:[Object(a.jsx)("div",{className:"user-form__errorMessage",children:o}),Object(a.jsx)("h2",{className:"user-form__title",children:r}),Object(a.jsx)("div",{className:"user-form__fields-container",children:s}),Object(a.jsx)("div",{className:"user-form__submit",children:i?Object(a.jsx)(h,{}):Object(a.jsx)(m,{title:n,type:"submit"})}),Object(a.jsx)("span",{className:"user-form__link",children:c})]})});x.defaultProps={link:null,errorMessage:"",showLoader:!1};var O=x,g=r(17),v=r(3),w=r.n(v),k=r(12),y=r(18),E=r.n(y),N="AIzaSyAhN5mGlbdn3ENY2HF0WXm415sMJOn9Zq4",_={signUp:function(e,t){return E()("https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=".concat(N),{method:"post",headers:{"Content-Type":"application/json"},data:{email:e,password:t,returnSecureToken:"true"}})},signIn:function(e,t){return E()("https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=".concat(N),{method:"post",headers:{"Content-Type":"application/json"},data:{email:e,password:t,returnSecureToken:"true"}})},updateProfile:function(e,t){return E()("https://identitytoolkit.googleapis.com/v1/accounts:update?key=".concat(N),{method:"post",headers:{"Content-Type":"application/json"},data:{idToken:e,displayName:t,returnSecureToken:"true"}})},getUserData:function(e){return E()("https://identitytoolkit.googleapis.com/v1/accounts:lookup?key=".concat(N),{method:"post",headers:{"Content-Type":"application/json"},data:{idToken:e}})},setRefreshToken:function(e){localStorage.setItem("refreshToken",e)},getRefreshToken:function(){return localStorage.getItem("refreshToken")},getAccessToken:function(){var e=this;return Object(k.a)(w.a.mark((function t(){var r,a,n,s,c;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.getRefreshToken(),t.next=3,E()("https://securetoken.googleapis.com/v1/token?key=".concat(N),{method:"post",headers:{"Content-Type":"application/json"},data:{grant_type:"refresh_token",refresh_token:r}});case 3:return a=t.sent,n=a.data,s=n.refresh_token,c=n.id_token,e.setRefreshToken(s),t.abrupt("return",c);case 7:case"end":return t.stop()}}),t)})))()}},T=Object(g.c)({name:"user",initialState:{userData:null,status:"idle",error:null,isLoggedIn:!!_.getRefreshToken()},reducers:{writeUserData:function(e,t){var r=t.payload;e.status="success",e.error=null,e.userData=r,e.isLoggedIn=!0},registration:function(e){e.status="pending"},authorization:function(e){e.status="pending"},fetchUserData:function(e){e.status="pending"},logout:function(e){e.userData=null,e.status="failure",e.error={message:"LOGOUT"},e.isLoggedIn=!1},writeError:function(e,t){var r=t.error;e.status="failure",e.userData=null,e.error=r,e.isLoggedIn=!1}}}),M=T.reducer,S=T.actions,I=function(e){return e.user.error},R=function(e){return e.user.userData},D=function(e){return e.user.status},A=function(e){return e.user.isLoggedIn},L=r(4),C=w.a.mark(q),U=w.a.mark(J),z=S.writeError,P=S.fetchUserData;function q(){var e,t;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=3,Object(L.g)("user/registration");case 3:return e=r.sent,t=e.payload,r.next=7,Object(L.c)(J,t);case 7:r.next=0;break;case 9:case"end":return r.stop()}}),C)}function J(e){var t,r,a,n,s,c,o,i;return w.a.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return t=e.email,r=e.password,a=e.username,u.prev=1,u.next=4,Object(L.b)(_,_.signUp,[t,r]);case 4:return n=u.sent,s=n.data,c=s.idToken,o=s.refreshToken,_.setRefreshToken(o),u.next=9,Object(L.b)(_,_.updateProfile,[c,a]);case 9:return u.next=11,Object(L.e)(P());case 11:u.next=22;break;case 13:if(u.prev=13,u.t0=u.catch(1),!u.t0.isAxiosError){u.next=21;break}return i=u.t0.response.data.error,u.next=19,Object(L.e)(Object(d.a)(Object(d.a)({},z()),{},{error:i}));case 19:u.next=22;break;case 21:throw u.t0;case 22:case"end":return u.stop()}}),U,null,[[1,13]])}var B=w.a.mark(H),F=w.a.mark(V),W=S.writeError,G=S.fetchUserData;function H(){var e,t,r;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e=!!_.getRefreshToken();case 1:if(e){a.next=11;break}return a.next=5,Object(L.g)("user/authorization");case 5:return t=a.sent,r=t.payload,a.next=9,Object(L.d)(V,r);case 9:a.next=13;break;case 11:return a.next=13,Object(L.e)(G());case 13:return a.next=15,Object(L.g)(["user/writeUserData","user/writeError"]);case 15:if("user/writeUserData"!==a.sent.type){a.next=20;break}return a.next=19,Object(L.g)("user/logout");case 19:a.sent;case 20:return a.next=22,Object(L.b)(_,_.setRefreshToken,[""]);case 22:e=!1,a.next=1;break;case 25:case"end":return a.stop()}}),B)}function V(e){var t,r,a,n,s;return w.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.email,r=e.password,c.prev=1,c.next=4,Object(L.b)(_,_.signIn,[t,r]);case 4:return a=c.sent,n=a.data.refreshToken,_.setRefreshToken(n),c.next=9,Object(L.e)(G());case 9:c.next=20;break;case 11:if(c.prev=11,c.t0=c.catch(1),!c.t0.isAxiosError){c.next=19;break}return s=c.t0.response.data.error,c.next=17,Object(L.e)(Object(d.a)(Object(d.a)({},W()),{},{error:s}));case 17:c.next=20;break;case 19:throw c.t0;case 20:case"end":return c.stop()}}),F,null,[[1,11]])}var X=w.a.mark(K),$=w.a.mark(Q),Y=S.writeUserData,Z=S.writeError;function K(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,Object(L.g)("user/fetchUserData");case 3:return e.next=5,Object(L.c)(Q);case 5:e.next=0;break;case 7:case"end":return e.stop()}}),X)}function Q(){var e,t,r,a;return w.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(L.b)(_,_.getRefreshToken);case 3:return e=n.sent,n.next=6,Object(L.b)(_,_.getAccessToken,[e]);case 6:return t=n.sent,n.next=9,Object(L.b)(_,_.getUserData,[t]);case 9:return r=n.sent,n.next=12,Object(L.e)(Y(r.data.users[0]));case 12:n.next=23;break;case 14:if(n.prev=14,n.t0=n.catch(0),!n.t0.isAxiosError){n.next=22;break}return a=n.t0.response.data.error,n.next=20,Object(L.e)(Object(d.a)(Object(d.a)({},Z()),{},{error:a}));case 20:n.next=23;break;case 22:throw n.t0;case 23:case"end":return n.stop()}}),$,null,[[0,14]])}var ee=w.a.mark(te);function te(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.a)([q(),H(),K()]);case 2:case"end":return e.stop()}}),ee)}var re=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/,ae=S.registration,ne=I,se=D,ce=A;function oe(e){switch(e){case"EMAIL_EXISTS":return"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441 \u0434\u0430\u043d\u043d\u044b\u043c email \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442";case"INVALID_EMAIL":return"\u041d\u0435\u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u044b\u0439 email";default:return""}}var ie=function(){var e=Object(i.d)(ne),t=Object(i.d)(se),r=Object(i.d)(ce),n=Object(i.c)(),s=Object(l.a)(),c=s.register,o=s.handleSubmit,d=s.watch,p=s.errors,f=s.reset,m={required:!0,pattern:{value:re,message:"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 email"}},h={required:!0,minLength:{value:6,message:"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043e\u0442 6 \u0434\u043e 30 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"},maxLength:{value:30,message:"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043e\u0442 6 \u0434\u043e 30 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"},validate:function(e){return e===d("password")||"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442"}};return r?Object(a.jsx)(b.a,{to:"/rooms"}):Object(a.jsxs)(O,{onSubmit:o((function(e){var t=e.password,r=e.email,a=e.username;n(ae({email:r,password:t,username:a})),f()})),title:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",buttonTitle:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",link:Object(a.jsx)(u.b,{to:"/auth",children:"\u0415\u0441\u0442\u044c \u0430\u043a\u043a\u0430\u0443\u043d\u0442?"}),errorMessage:e&&oe(e.message),showLoader:"pending"===t,children:[Object(a.jsx)(j,{title:"\u0418\u043c\u044f",name:"username",type:"text",ref:c({required:!0,minLength:{value:3,message:"\u041e\u0448\u0438\u0431\u043a\u0430: \u043e\u0442 3 \u0434\u043e 20 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"},maxLength:{value:20,message:"\u041e\u0448\u0438\u0431\u043a\u0430: \u043e\u0442 3 \u0434\u043e 20 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"}}),errorMessage:p.username&&p.username.message}),Object(a.jsx)(j,{title:"Email",name:"email",type:"text",ref:c(m),errorMessage:p.email&&p.email.message}),Object(a.jsx)(j,{title:"\u041f\u0430\u0440\u043e\u043b\u044c",name:"password",type:"password",ref:c(h),errorMessage:p.password&&p.password.message}),Object(a.jsx)(j,{title:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c",name:"password-repeat",type:"password",ref:c(h),errorMessage:p["password-repeat"]&&p["password-repeat"].message})]})},ue=I,be=D,le=A,de=S.authorization;function pe(e){switch(e){case"EMAIL_NOT_FOUND":return"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d";case"INVALID_PASSWORD":return"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c";default:return""}}var je=function(){var e=Object(i.d)(ue),t=Object(i.d)(be),r=Object(i.d)(le),n=Object(i.c)(),s=Object(l.a)(),c=s.register,o=s.handleSubmit,d=s.errors,p={required:!0,pattern:{value:re,message:"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 email"}};return r?Object(a.jsx)(b.a,{to:"/rooms"}):Object(a.jsxs)(O,{onSubmit:o((function(e){var t=e.email,r=e.password;n(de({email:t,password:r}))})),title:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f",buttonTitle:"\u0412\u043e\u0439\u0442\u0438",link:Object(a.jsx)(u.b,{to:"/reg",children:"\u041d\u0435\u0442 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430?"}),errorMessage:e&&pe(e.message),showLoader:"pending"===t,children:[Object(a.jsx)(j,{title:"Email",name:"email",type:"text",ref:c(p),errorMessage:d.email&&d.email.message}),Object(a.jsx)(j,{title:"\u041f\u0430\u0440\u043e\u043b\u044c",name:"password",type:"password",ref:c({required:!0}),errorMessage:d.password&&d.password.message})]})},fe=Object(g.b)(),me=Object(g.c)({name:"rooms",initialState:fe.getInitialState({status:"idle",error:null}),reducers:{writeRoomsData:function(e,t){fe.upsertMany(e,t),e.status="success",e.error=null},fetchRooms:function(e){e.status="pending"},writeError:function(e,t){var r=t.error;e.status="failure",fe.removeAll(e),e.error=r}}}),he=me.actions,xe=me.reducer,Oe=fe.getSelectors((function(e){return e.rooms})),ge={selectRoomsEntities:Oe.selectEntities,selectRoomsIds:Oe.selectIds,selectRoomById:Oe.selectById,selectRoomsStatus:function(e){return e.rooms.status}},ve={addNewRoom:function(e,t){return Object(k.a)(w.a.mark((function r(){var a;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,E()("https://my-chat-1bfb6.firebaseio.com/rooms.json?auth=".concat(t),{method:"post",headers:{"Content-Type":"application/json"},data:{name:e}});case 2:return a=r.sent,r.abrupt("return",a.data);case 4:case"end":return r.stop()}}),r)})))()},getRooms:function(e){return Object(k.a)(w.a.mark((function t(){var r;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,E()("https://my-chat-1bfb6.firebaseio.com/rooms.json?auth=".concat(e),{method:"get",headers:{"Content-Type":"application/json"}});case 2:return r=t.sent,t.abrupt("return",r.data);case 4:case"end":return t.stop()}}),t)})))()}},we=w.a.mark(Ne),ke=w.a.mark(_e),ye=he.writeError,Ee=he.writeRoomsData;function Ne(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.i)("rooms/fetchRooms",_e);case 2:case"end":return e.stop()}}),we)}function _e(){var e,t,r,a,n;return w.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Object(L.b)(_,_.getRefreshToken);case 3:return e=s.sent,s.next=6,Object(L.b)(_,_.getAccessToken,[e]);case 6:return t=s.sent,s.next=9,Object(L.b)(ve,ve.getRooms,[t]);case 9:return r=s.sent,a=Object.keys(r).map((function(e){return Object(d.a)({id:e},r[e])})),s.next=13,Object(L.e)(Ee(a));case 13:s.next=24;break;case 15:if(s.prev=15,s.t0=s.catch(0),!s.t0.isAxiosError){s.next=23;break}return n=s.t0.response.data.error,s.next=21,Object(L.e)(Object(d.a)(Object(d.a)({},ye()),{},{error:n}));case 21:s.next=24;break;case 23:throw s.t0;case 24:case"end":return s.stop()}}),ke,null,[[0,15]])}var Te=w.a.mark(Me);function Me(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.a)([Ne()]);case 2:case"end":return e.stop()}}),Te)}r(83);var Se=he.fetchRooms,Ie=S.logout,Re=ge.selectRoomsEntities,De=ge.selectRoomsStatus,Ae=function(){var e=Object(i.d)(Re),t=Object(i.d)(De),r=Object(i.c)();Object(n.useEffect)((function(){r(Se())}),[]);var s=Object.keys(e).map((function(t){return Object(a.jsx)("li",{className:"room-list__list-item",children:Object(a.jsx)(u.b,{to:"/rooms/".concat(t),children:e[t].name})},t)}));return Object(a.jsxs)("div",{className:"room-list app-border",children:[Object(a.jsx)("div",{className:"room-list__top-bar",children:Object(a.jsx)("button",{className:"room-list__logout",type:"button",onClick:function(){r(Ie())},children:Object(a.jsx)("i",{className:"fa fa-sign-out","aria-hidden":"true"})})}),Object(a.jsx)("h2",{className:"room-list__title",children:"\u041a\u043e\u043c\u043d\u0430\u0442\u044b"}),Object(a.jsxs)("ul",{className:"room-list__list",children:["pending"===t&&Object(a.jsx)("div",{className:"room-list__loader",children:Object(a.jsx)(h,{})}),s]})]})},Le=r(22),Ce=Object(g.b)({sortComparer:function(e,t){return e.date.localeCompare(t.date)}}),Ue=Object(g.c)({name:"chat",initialState:Ce.getInitialState({status:"idle",error:null}),reducers:{subscribeNewMessages:function(e){e.error=null,e.status="idle"},unsubscribeNewMessages:function(e){Ce.removeAll(e)},sendMessage:function(e){e.status="pending"},writeError:function(e,t){var r=t.error;e.status="failure",e.error=r},writeMessages:function(e,t){var r=t.payload;e.status="success",e.error=null,Ce.addMany(e,r)}}}),ze={selectChatEntities:Ce.getSelectors((function(e){return e.chat})).selectEntities},Pe=Ue.reducer,qe=Ue.actions,Je={getChat:function(e,t){return E()("https://my-chat-1bfb6.firebaseio.com/chats/".concat(t,".json?auth=").concat(e),{method:"get",headers:{"Content-Type":"application/json"}})},sendMessage:function(e,t,r,a){return E()("https://my-chat-1bfb6.firebaseio.com/chats/".concat(r,"/messages.json?auth=").concat(e),{method:"post",headers:{"Content-Type":"application/json"},data:{message:a,nameAuthor:t,date:(new Date).toISOString()}})},subscribeNewMessages:function(e,t,r){var a=new EventSource("https://my-chat-1bfb6.firebaseio.com/chats/".concat(t,"/messages.json?auth=").concat(e));return a.addEventListener("put",(function(e){var t=JSON.parse(e.data);if(t.data)if("/"===t.path){var a=Object.keys(t.data).map((function(e){return Object(d.a)({id:e},t.data[e])}));r(a)}else{var n=[Object(d.a)({id:t.path.slice(1)},t.data)];r(n)}})),a.close.bind(a)}},Be=w.a.mark(He),Fe=w.a.mark(Ve),We=R,Ge=qe.writeError;function He(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.h)("chat/sendMessage",Ve);case 2:case"end":return e.stop()}}),Be)}function Ve(e){var t,r,a,n,s,c,o;return w.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.payload,i.prev=1,i.next=4,Object(L.f)(We);case 4:return r=i.sent,a=r.displayName,n=t.chatId,s=t.message,i.next=9,Object(L.b)(_,_.getAccessToken);case 9:return c=i.sent,i.next=12,Object(L.b)(Je,Je.sendMessage,[c,a,n,s]);case 12:i.next=23;break;case 14:if(i.prev=14,i.t0=i.catch(1),!i.t0.isAxiosError){i.next=22;break}return o=i.t0.response.data.error,i.next=20,Object(L.e)(Object(d.a)(Object(d.a)({},Ge()),{},{error:o}));case 20:i.next=23;break;case 22:throw i.t0;case 23:case"end":return i.stop()}}),Fe,null,[[1,14]])}var Xe=r(31),$e=w.a.mark(et),Ye=w.a.mark(tt),Ze=w.a.mark(at),Ke=qe.writeError,Qe=qe.writeMessages;function et(){var e,t;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=3,Object(L.g)("chat/subscribeNewMessages");case 3:return e=r.sent,t=e.payload,r.next=7,Object(L.c)(tt,t);case 7:r.next=0;break;case 9:case"end":return r.stop()}}),$e)}function tt(e){var t,r,a,n;return w.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Object(L.b)(_,_.getAccessToken);case 3:return t=s.sent,s.next=6,Object(L.c)(rt,e,t);case 6:return r=s.sent,s.next=9,Object(L.d)(at,r);case 9:return s.next=12,Object(L.g)(r);case 12:return a=s.sent,s.next=15,Object(L.e)(Qe(a));case 15:s.next=9;break;case 17:s.next=28;break;case 19:if(s.prev=19,s.t0=s.catch(0),!s.t0.isAxiosError){s.next=27;break}return n=s.t0.response.data.error,s.next=25,Object(L.e)(Object(d.a)(Object(d.a)({},Ke()),{},{error:n}));case 25:s.next=28;break;case 27:throw s.t0;case 28:case"end":return s.stop()}}),Ye,null,[[0,19]])}function rt(e,t){return Object(Xe.b)((function(r){return Je.subscribeNewMessages(t,e,(function(e){return r(e)}))}))}function at(e){return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(L.g)("chat/unsubscribeNewMessages");case 2:e.close();case 3:case"end":return t.stop()}}),Ze)}var nt=w.a.mark(st);function st(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.a)([He(),et()]);case 2:case"end":return e.stop()}}),nt)}r(84);var ct=qe.sendMessage,ot=function(){var e=Object(n.useState)(""),t=Object(Le.a)(e,2),r=t[0],s=t[1],c=Object(b.g)().chatId,o=Object(i.c)(),u=function(){var e=Object(k.a)(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),o(ct({chatId:c,message:r})),s("");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.jsxs)("form",{className:"message-form",onSubmit:u,children:[Object(a.jsx)("input",{type:"text",value:r,onChange:function(e){return s(e.target.value)}}),Object(a.jsx)(m,{type:"submit",title:Object(a.jsx)("i",{className:"fa fa-paper-plane","aria-hidden":"true"})})]})},it=(r(85),ze.selectChatEntities),ut=function(){var e=Object(i.d)(it),t=Object.keys(e).map((function(t){return Object(a.jsxs)("li",{className:"messages-list__message",children:[e[t].nameAuthor,":"," ",e[t].message]},t)}));return Object(a.jsx)("ul",{className:"messages-list",ref:function(e){e&&(e.scrollTop=null===e||void 0===e?void 0:e.scrollHeight)},children:t})},bt=(r(86),qe.subscribeNewMessages),lt=qe.unsubscribeNewMessages,dt=function(){var e=Object(b.g)().chatId,t=Object(i.c)();return Object(n.useEffect)((function(){return t(bt(e)),function(){return t(lt())}}),[]),Object(a.jsxs)("div",{className:"app-border chat",children:[Object(a.jsx)("div",{className:"chat__top-bar",children:Object(a.jsx)(u.b,{className:"chat__back",to:"/rooms",children:Object(a.jsx)("i",{className:"fa fa-chevron-left"})})}),Object(a.jsx)(ut,{}),Object(a.jsx)(ot,{})]})},pt=(r(87),r(47)),jt=r(48),ft=r(50),mt=r(49);var ht=function(e){Object(ft.a)(r,e);var t=Object(mt.a)(r);function r(e){var a;return Object(pt.a)(this,r),(a=t.call(this,e)).state={hasError:!1},a}return Object(jt.a)(r,[{key:"componentDidCatch",value:function(){this.setState({hasError:!0})}},{key:"render",value:function(){var e=this.state.hasError,t=this.props,r=t.children,n=t.criticalError;return e||n?Object(a.jsx)("h1",{children:"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u0441\u0438\u043b\u044c\u043d\u043e \u043d\u0435 \u0442\u0430\u043a! \u0418\u0437\u0432\u0438\u043d\u0438\u0442\u0435."}):r}}]),r}(s.a.Component);ht.defaultProps={criticalError:null};var xt=Object(i.b)((function(e){return{criticalError:e.app.criticalError}}))(ht),Ot=A,gt=function(){var e=Object(i.d)(Ot);return Object(a.jsx)(xt,{children:Object(a.jsx)(u.a,{children:Object(a.jsxs)(b.d,{children:[Object(a.jsx)(b.b,{path:"/reg",component:ie,exact:!0}),Object(a.jsx)(b.b,{path:"/auth",component:je,exact:!0}),e&&Object(a.jsx)(b.b,{path:"/rooms/:chatId",component:dt}),e&&Object(a.jsx)(b.b,{path:"/rooms",component:Ae}),e&&Object(a.jsx)(b.a,{to:"/rooms"}),Object(a.jsx)(b.a,{to:"/auth"})]})})})},vt=Object(g.c)({name:"app",initialState:{criticalError:null},reducers:{criticalError:function(e,t){var r=t.error;e.criticalError=r.stack}}}),wt=vt.reducer,kt=(vt.actions,Object(Xe.a)()),yt=Object(g.a)({reducer:{app:wt,user:M,rooms:xe,chat:Pe},middleware:[kt]});kt.run(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(L.a)([te(),Me(),st()]);case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,Object(L.e)({type:"app/criticalError",error:e.t0});case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));r(88);o.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(i.a,{store:yt,children:Object(a.jsx)(gt,{})})}),document.getElementById("root"))}},[[89,1,2]]]);
//# sourceMappingURL=main.2326c85d.chunk.js.map